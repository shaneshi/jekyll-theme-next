---
title: 高德地图SDK的使用
description: 此篇文章我们通过一个案例，通过定位与地图相结合使用展示高德地图SDK的基本效果。
categories:
 - 教程
tags:
---





# 导入相关头文件

设置相关属性,遵守相关代理协议。

```objc
#import "ViewController.h"
#import <AMapLocationKit/AMapLocationKit.h>
#import <MAMapKit/MAMapKit.h>
@interface ViewController ()<MAMapViewDelegate,AMapLocationManagerDelegate>
@property (nonatomic, strong) MAMapView *mapView;//地图视图
@property (nonatomic, strong) AMapLocationManager *locationManager;//定位管理者
@end
```

# 初始化所需控件

* 懒加载方式初始化MAMapView。

```objc
- (MAMapView *)mapView {
    if (!_mapView) {
        _mapView = [[MAMapView alloc] initWithFrame:CGRectMake(0, 0, CGRectGetWidth(self.view.bounds), CGRectGetHeight(self.view.bounds))];
        _mapView.delegate = self;
        _mapView.mapType = MAMapTypeStandard;//设置地图类型
        _mapView.showTraffic= YES;//是否显示交通图
        [self.locationManager startUpdatingLocation];//开始定位
        [_mapView setUserTrackingMode: MAUserTrackingModeFollow animated:YES];//定位以后改变地图的图层显示。
    }
    return _mapView;
}
```

* 懒加载方式初始化MapLocationManager。

```objc
- (AMapLocationManager *)locationManager {
    if (!_locationManager) {
        _locationManager = [[AMapLocationManager alloc] init];
        _locationManager.delegate = self;
        //设置连续定位可返回逆地理信息
        _locationManager.locatingWithReGeocode = YES;
    }
    return _locationManager;
}
```

* 程序运行时调用定位，添加地图。

```objc
- (void)viewDidLoad {
    [super viewDidLoad];
    [self locationManager];
    [self.view addSubview:self.mapView];
}
```

# 设置定位的运行时机

* 在viewDidAppear方法中开始定位。

```objc
- (void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];
    [self.locationManager startUpdatingLocation];  
}
```

* 控制器视图消失时，停止定位。

```objc
- (void)viewDidDisappear:(BOOL)animated {
    [super viewDidDisappear:animated];
    [self.locationManager stopUpdatingLocation];
}
```

# 实现代理方法

* AMapLocationManagerDelegate中的代理方法，连续定位回调函数。

```objc
- (void)amapLocationManager:(AMapLocationManager *)manager 
          didUpdateLocation:(CLLocation *)location 
                  reGeocode:(AMapLocationReGeocode *)reGeocode {
    //在定位出添加一个大头针
    MAPointAnnotation *pointAnnotation = [[MAPointAnnotation alloc] init];
    pointAnnotation.coordinate = location.coordinate;
    pointAnnotation.title = reGeocode.district;
    pointAnnotation.subtitle = [NSString stringWithFormat:@"%@ %@ %@ %@",reGeocode.country,reGeocode.province,reGeocode.city,reGeocode.district];
    [self.mapView addAnnotation:pointAnnotation];
}
```

* MAMapViewDelegate中的代理方法，用来设置大头针。

```objc
- (MAAnnotationView *)mapView:(MAMapView *)mapView 
            viewForAnnotation:(id )annotation {
    if ([annotation isKindOfClass:[MAPointAnnotation class]]) {
        static NSString *pointReuseIndentifier = @"pointReuseIndentifier";
        MAPinAnnotationView *annotationView = (MAPinAnnotationView*)[mapView dequeueReusableAnnotationViewWithIdentifier:pointReuseIndentifier];
        if (annotationView == nil) {
            annotationView = [[MAPinAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:pointReuseIndentifier];
        }
        annotationView.canShowCallout= YES;       //设置气泡可以弹出，默认为NO
        annotationView.draggable = YES;        //设置标注可以拖动，默认为NO
        annotationView.pinColor = MAPinAnnotationColorPurple;
        return annotationView;
    }
    return nil;
}
```

运行效果：

<img src="http://7xta2c.com1.z0.glb.clouddn.com/99ios/1481506910586.png" width="219"/>

# 补充

通过下面的方法可隐藏状态栏，防止地图内容被遮挡。

```objc
- (BOOL)prefersStatusBarHidden {
    return YES;
}
```

---

